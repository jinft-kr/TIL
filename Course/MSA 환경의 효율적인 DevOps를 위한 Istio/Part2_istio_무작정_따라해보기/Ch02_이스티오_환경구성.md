### 01. istioctl을 이용한 환경 구성

- [Istio](https://istio.io/latest/docs/)

- Download Istio
  - curl -L https://istio.io/downloadIstio | sh -
  - cd istio-1.14.1
  - export PATH=$PWD/bin:$PATH
  
- Install with Istioctl
  - IstioOperator로 설치하는걸 권장하고 있음

### 02. istio-operator를 이용한 환경 구성
- ![istio_profile_configuration](https://user-images.githubusercontent.com/63401132/177031099-1a8c6566-d314-462f-b806-d683cef5c654.jpeg)

### 03. 사이드카 인젝션
- istio ingress를 통해서 트래픽이 들어옴
- istio injection이 되어 있지 않더라도 k8s만 사용해도 service mesh를 타진 않지만 pod까진 도착할 수 있음
- 대신 istio 매트릭이나 매쉬를 사용하는데 제한이 있을 수 있음

- Pod/sidecar container
    - 파드내 네트워크 인터페이스를 컨테이너끼리 공유
    - Iptabels를 조작하여 inbound traffic과 outbound traffic 모두를 istio-proxy가 선처리
    - 서비스 앱의 세밀한 `네트워킹 설정에 대한 책임` 을 가져옴

- sidecar injection하는 방법 2가지
    - istioctl kube-inejct 명령어
        - istioctl kube-inject -f sample.yaml | kubectl apply -f -
    - auto injection with namespace label
        - kubectl labe ns defailt istio-ingjection=enabled
            - 해당 네임스페이스에 뜨는 모든 파드들은 istio 사이드카가 자동으로 injection됨
            - 제거 명령어의 경우, kubectl label namespace default istio-injection --

- injection control with label
  - Controlling the injection policy
    - ![controlling_the_injection_policy](https://user-images.githubusercontent.com/63401132/177031100-6ac2262a-bd5b-49d5-8a2f-76ec3fcae24e.jpeg)
    - template.metadata.label에 sidecar.istio.io/inject: "false" 설정

### 04. 호스트 개념과 트래픽 라우팅
- host
- host는 운영체제별로 host file로 관리되고 있음
  - mac의 경우에는 /etc/hosts에 저장되어 있음
  - ![host_file_on_mac](https://user-images.githubusercontent.com/63401132/177031332-37e38a68-7134-4e98-b9f1-a5ae7f5e934d.jpeg)
- `google.com` host ip를 확인해보자
  - ![curl_google](https://user-images.githubusercontent.com/63401132/177031328-d0cbe0c4-09e4-46b3-8a79-777392cf08e5.jpeg)
  - lookup된 ip : `142.251.42.206`
- proxy
